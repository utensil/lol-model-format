
<!-- saved from url=(0043)http://www.wazim.com/Collada_Tutorial_2.htm -->
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

<!-- style -->
<link rel="stylesheet" type="text/css" href="./Collada_Tutorial_2_files/styleCreation.css">
<!-- script -->
<title>Step by Step Skeletal Animation</title>
<style>
<!--
 p.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";
	margin-left:0in; margin-right:0in; margin-top:0in}
-->
</style>
<link type="text/css" rel="stylesheet" href="chrome-extension://imamemhokkdleoelohnmkimbmpfglcil/css/capture.css"><style id="__huaban_Style">#__huaban_Container {font-family: 'helvetica neue', arial, sans-serif; position: absolute; padding-top: 37px; z-index: 100000002; top: 0; left: 0; background-color: transparent; opacity: 1;hasLayout:-1;}#__huaban_Overlay {position: fixed; z-index: 100000001; top: 0; right: 0; bottom: 0; left: 0; background-color: #f2f2f2; opacity: .95;}* html #__huaban_Overlay {position: absolute;}#__huaban_Control {position:relative; z-index: 100000; float: left; background-color: #fcf9f9; border: solid #ccc; border-width: 0 1px 1px 0; height: 200px; width: 200px; opacity: 1;}* html #__huaban_Control {position:static;}#__huaban_Control img {position: relative; padding: 0; display: block; margin: 82px auto 0; -ms-interpolation-mode: bicubic;}#__huaban_Control a {position: fixed; z-index: 10001; right: 0; top: 0; left: 0; height: 24px; padding: 12px 0 0; text-align: center; font-size: 14px; line-height: 1em; text-shadow: 0 1px #fff; color: #211922; font-weight: bold; text-decoration: none; background: #fff url(http://huaban.com/img/fullGradient07Normal.png) 0 0 repeat-x; border-bottom: 1px solid #ccc; -mox-box-shadow: 0 0 2px #d7d7d7; -webkit-box-shadow: 0 0 2px #d7d7d7;}* html #__huaban_Control a {position: absolute; width: 100%;}#__huaban_Control a:hover {color: #fff; text-decoration: none; background-color: #1389e5; border-color: #1389e5; text-shadow: 0 -1px #46A0E6;}#__huaban_Control a:active {height: 23px; padding-top: 13px; background-color: #211922; border-color: #211922; background-image: url(http://huaban.com/img/fullGradient07Inverted.png); text-shadow: 0 -1px #211922;}.__huabanImagePreview {position: relative; padding: 0; margin: 0; float: left; background-color: #fff; border: solid #e7e7e7; border-width: 0 1px 1px 0; height: 200px; width: 200px; opacity: 1; z-index: 10002; text-align: center; overflow:hidden;}.__huabanImagePreview .__huabanVideoIcon {position:absolute;display:block;top:0;left:0;width:100%;height:100%;background:url(http://huaban.com/img/media_video.png) center center no-repeat;}.__huabanImagePreview .__huabanImg {border: none; height: 200px; width: 200px; opacity: 1; padding: 0; position: absolute; top: 0;}.__huabanImagePreview .__huabanImg a {margin: 0; padding: 0; position: absolute; top: 0; bottom: 0; right: 0; left: 0; display: block; text-align: center;  z-index: 1;}.__huabanImagePreview .__huabanImg a:hover {background-color: #fcf9f9; border: none;}.__huabanImagePreview .__huabanImg .ImageToPin {max-height: 200px; max-width: 200px; width: auto !important; height: auto !important;}.__huabanImagePreview img.__huaban_PinIt {border: none; position: absolute; top: 82px; left: 42px; display: none; padding: 0; background-color: transparent; z-index: 100;}.__huabanImagePreview strong {text-indent: -9999px; position: absolute; top: 82px; display: none; height: 32px; background: url(http://huaban.com/img/bm_pin_sprite.png?20120801) no-repeat 0 0;}.__huabanImagePreview strong.__huaban_ThunderPin {width: 24px; left: 52px; background-position: 0 0;}.__huabanImagePreview strong.__huaban_ThunderPin:hover {background-position: 0 -50px;}.__huabanImagePreview strong.__huaban_ThunderPin:active {background-position: 0 -100px;}.__huabanImagePreview strong.__huaban_Pin {width: 72px; left: 75px; background-position: -40px 0;}.__huabanImagePreview strong.__huaban_Pin:hover {background-position: -40px -50px;}.__huabanImagePreview strong.__huaban_Pin:active {background-position: -40px -100px;}.__huabanImagePreview img.__huaban_vidind {border: none; position: absolute; top: 75px; left: 75px; padding: 0; background-color: transparent; z-index: 99;}.__huabanDimensions { color: #000; position: relative; margin-top: 180px; text-align: center; font-size: 10px; z-index:10003; display: inline-block; background: white; border-radius: 4px; padding: 0 2px;}#__huaban_Button, #__huaban_Button *, #__huaban_Container, #__huaban_Container * { -webkit-box-sizing: content-box; -moz-box-sizing: content-box; -ms-box-sizing: content-box; box-sizing: content-box;}#__huaban_Button { display: block; position: absolute; z-index: 999999999 !important; color: #211922; text-shadow: 0 1px #eaeaea; font: 12px/1 'Helvetica Neue',Helvetica,Arial,Sans-serif; text-align: center; padding: 0; margin: 0; cursor: pointer;}#__huaban_Button a {text-decoration: none; color: #211922; display: inline-block; text-align: center; line-height: 14px; height: 14px; border-radius: 2px; -webkit-border-radius: 2px; -moz-border-radius: 2px; -ms-border-radius: 2px; -o-border-radius: 2px; cursor: pointer; position: absolute; top: 0; left: 0; height: 14px; margin: 0 2px; padding: 5px 8px; border: 1px solid #555; border: 1px solid rgba(140, 126, 126, .5); background-color: #fff;}#__huaban_Button a:hover {text-decoration: none; background-image: -webkit-linear-gradient(top, #fefeff, #efefef); background-image: -moz-linear-gradient(top, #fefeff, #efefef); box-shadow: inset 0 1px rgba(255,255,255,0.35), 0 1px 1px rgba(35,24,24,0.75); -o-box-shadow: inset 0 1px rgba(255,255,255,0.35), 0 1px 1px rgba(35,24,24,0.75); -ms-box-shadow: inset 0 1px rgba(255,255,255,0.35), 0 1px 1px rgba(35,24,24,0.75); -moz-box-shadow: inset 0 1px rgba(255,255,255,0.35), 0 1px 1px rgba(35,24,24,0.75); -webkit-box-shadow: inset 0 1px rgba(255,255,255,0.35), 0 1px 1px rgba(35,24,24,0.75);}#__huaban_Button a:active {text-decoration: none; background-image: -webkit-linear-gradient(top, #fefeff, #efefef); background-image: -moz-linear-gradient(top, #fefeff, #efefef); box-shadow: inset 0 1px 2px rgba(34,25,25,0.25), 0 0 1px rgba(232,230,230,0.5); -o-box-shadow: inset 0 1px 2px rgba(34,25,25,0.25), 0 0 1px rgba(232,230,230,0.5); -ms-box-shadow: inset 0 1px 2px rgba(34,25,25,0.25), 0 0 1px rgba(232,230,230,0.5); -moz-box-shadow: inset 0 1px 2px rgba(34,25,25,0.25), 0 0 1px rgba(232,230,230,0.5); -webkit-box-shadow: inset 0 1px 2px rgba(34,25,25,0.25), 0 0 1px rgba(232,230,230,0.5);}#__huaban_Button a strong {position: relative; line-height: 12px;}#__huaban_Button a.thunderpin {margin-right: 0; border-right: none; width: 14px; padding: 5px 0 5px 4px; border-top-right-radius: 0; border-bottom-right-radius: 0; -webkit-border-top-right-radius: 0; -webkit-border-bottom-right-radius: 0; -moz-border-top-right-radius: 0; -moz-border-bottom-right-radius: 0; -ms-border-top-right-radius: 0; -ms-border-bottom-right-radius: 0; -o-border-top-right-radius: 0; -o-border-bottom-right-radius: 0;}#__huaban_Button a.thunderpin em {background: url(http://huaban.com/img/ActionIcons10.png?20120801) no-repeat -30px 0; position: relative; display: inline-block; width: 10px; height: 10px; top: 1px; left: -2px;}#__huaban_Button a.thunderpin:hover em {background-image-postion: -30px -10px;}#__huaban_Button a.thunderpin:active em {background-image-postion: -30px -20px;}#__huaban_Button a.pin {left: 20px; width: 64px; margin-left: 0; *margin-left: -2px; border-top-left-radius: 0; border-bottom-left-radius: 0; -webkit-border-top-left-radius: 0; -webkit-border-bottom-left-radius: 0; -moz-border-top-left-radius: 0; -moz-border-bottom-left-radius: 0; -ms-border-top-left-radius: 0; -ms-border-bottom-left-radius: 0; -o-border-top-left-radius: 0; -o-border-bottom-left-radius: 0;}.__huaban_Button_share {text-indent: -9999px; width: 68px; height: 24px; padding:0; background: url(http://huaban.com/img/sharebutton_sprite.png?20121226) no-repeat 0 -80px !important; border: none;}.__huaban_Button_share:hover {background-position: 0 -120px; background-position: 0 -120px !important;}.__huaban_Button_share_top {background-position: 0 -80px; background-position: 0 -80px !important;}.__huaban_Button_share_top:hover {background-position: 0 -120px; background-position: 0 -120px !important;}.__huaban_Button_share_bottom {background-position: 0 0; background-position: 0 0 !important;}.__huaban_Button_share_bottom:hover {background-position: 0 -40px; background-position: 0 -40px !important;}.__huaban_thunder_tip { height: 16px; position: absolute; z-index: 999999999 !important; background: #000; background: rgba(0,0,0,0.5); color: #ddd; line-height: 16px; padding: 5px; border-radius: 2px; margin-left: 2px; }.__huabanImagePreview .__huaban_thunder_tip {height: 12px; line-height: 12px; padding: 10px; font-size: 14px; top: 50%; left: 50%; margin-left: -48px; margin-top: -18px;}.__huaban_thunder_tip_success {color: #fff;font-weight: bold; height: 32px;}.__huaban_thunder_tip p {font-weight: normal; text-align: center; margin-top: 2px;}.__huaban_thunder_tip a {color: #fff;}.__huaban_thunder_tip_failed {height: 32px; font-weight: bold; color: #fff;background: #c90000; background: rgba(201, 0, 0, .5); }.__huaban_thunder_tip_failed p {margin: 0 2px; font-weight: normal; font-size: 12px;}.__huaban_thunder_tip span { padding-left: 18px; position: relative;}.__huaban_thunder_tip span em { background: url(http://huaban.com/img/bm_pin_sprite.png?20120801) no-repeat 0px -150px; display: inline-block; height: 16px; width: 16px; position: absolute; left: 0; top: 50%; margin-top: -8px;}.__huaban_thunder_tip_success span em { background: url(http://huaban.com/img/bm_pin_sprite.png?20120801) no-repeat 0px -150px;}.__huaban_thunder_tip_failed span em { background: url(http://huaban.com/img/bm_pin_sprite.png?20120801) no-repeat -40px -150px;}.__huaban_thunder_tip_ing span em { background: url(http://huaban.com/img/thunder_motion.gif?20120801) no-repeat 2px 2px;}.__huabanImagePreview .__huaban_thunder_tip_failed {height: 32px; width: 140px; margin-left: -80px; margin-top: -26px;}.__huabanImagePreview .__huaban_thunder_tip_success {height: 32px; width: 88px; margin-left: -52px; margin-top: -26px;}.__huabanImagePreview .__huaban_thunder_tip_ing {width: 72px;}.__huabanImagePreview .__huaban_thunder_tip_success p, .__huabanImagePreview .__huaban_thunder_tip_failed p {margin-top: 9px; font-size: 12px; display: block;}</style></head>

<body onload="CheckLoadedFrame2();" huaban_screen_capture_injected="true">
<script type="text/javascript">
<!--
/*
 onLoad="Loaded();" onUnLoad="UnLoaded();"
function Loaded()
{
	//alert("Loaded");
	//document.getElementById('CommentIFrame').style.height = document.getElementById('CommentIFrame').document.body.scrollHeight + 20;
}
function UnLoaded()
{
	//alert("Unloaded");
}
*/
function CheckLoadedFrame2()
{
	/*
	if( !window.frames['CommentIFrame'] ) 
	{ 
		window.alert( 'Frame has not loaded' ); 
	}
	else
	{
		window.alert( 'Frame has been loaded' ); 
	}*/
	parent.frames['CommentIFrame2'].window.location.reload();
}
function autoIframe(frameId)
{
	try
	{
		frame = document.getElementById(frameId);
		innerDoc = (frame.contentDocument) ? frame.contentDocument : frame.contentWindow.document;
		objToResize = (frame.style) ? frame.style : frame;
		objToResize.height = innerDoc.body.scrollHeight + 20;
	}
	catch(err)
	{
		window.status = err.message;
	}
}
//-->
</script>

<p class="MsoNormal" align="center" style="text-align: center"><b>
<span style="font-size: 14.0pt; font-family: Arial">Step by Step Skeletal 
Animation in C++ and OpenGL, Using COLLADA</span></b></p>
<p class="MsoNormal" align="center" style="text-align: center"><b>
<span style="font-size: 14.0pt; font-family: Arial">Part 2</span></b></p>
<div style="text-align: center"><a href="http://www.wazim.com/Collada_Tutorial_2.htm#Leave_Comment_CL2" onclick="">Leave a comment</a></div>
<p class="MsoNormal" align="center" style="text-align:center">Last update December 2010</p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><b>
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Level: Beginner 
to Intermediate</span></b></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Before you start reading 
the implementations part, if you haven't read the first part of this tutorial(s), 
which explains COLLADA documents in detail, you should follow the link below.</span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm">Part 1: 
COLLADA documents</a></span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">You should have seen the 
following structure. In part 1</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-indent: -.25in; margin-left: .5in">
<span style="font-family: Arial">1)<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7.0pt; font-family: Times New Roman">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-family: Arial">Reading and Understanding COLLADA 
documents. (high level overview of COLLADA)</span></p>
<p class="MsoNormal" style="text-indent: -.25in; margin-left: .5in">
<span style="font-family: Arial">2)<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7.0pt; font-family: Times New Roman">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-family: Arial">Actual Implementations in C++ 
using OpenGL, of what we learn in Part 1</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The one that your are 
reading now is the second part which has further two parts, </span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-indent: -.25in; margin-left: .5in">
<span style="font-family: Arial">1)<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7.0pt; font-family: Times New Roman">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-family: Arial">Implementation part related to 
the Exporter for COLLADA</span></p>
<p class="MsoNormal" style="text-indent: -.25in; margin-left: .5in">
<span style="font-family: Arial">2)<span style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 7.0pt; font-family: Times New Roman">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-family: Arial">Implementation part related to 
the skeletal animation in C++ using OpenGL</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">As far as the 
implementation of skeletal animation is concerned, we will Use OpenGL and C++, 
but the exporter which is used to export Data from COLLADA documents into my own 
Binary format (.CBA), I have written in C# (C Sharp). I could have written that 
in C++, but I was too lazy to write my own implementation of XML readers, while 
C# has very good implementation for that. And the free API for XML parsing (tinyXML) 
has a lot of issues which I was not really ready for. So I wrote my COLLADA 
exporter in C# and I create my binary file format which I call CBA files, from 
my exporter. CBA means COLLADA Binary Assets :) and later I import this file in 
C++ using a CBA reader API. Now this introduced a lot of problems for me, like I 
have to maintain almost similar code twice once in C# for my exporter and Once 
in C++ for my importer. So it would be better that you don't use my exporter and 
write your own Exporter in what ever language you prefer. And that would also 
help you understand the COLLADA documents in depth.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><b><span style="font-size: 14.0pt; font-family: Arial">Part 
2.1:</span></b></p>
<p class="MsoNormal"><b><span style="font-size: 14.0pt; font-family: Arial">
Implementation of Exporter for COLLADA, written in C#</span></b></p>
<p class="MsoNormal"><b><span style="font-size: 16.0pt; font-family: Arial">&nbsp;</span></b></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Implementation 
of Skeletal Animation in COLLADA documents</span></p>
<p class="MsoNormal"><span style="font-family: Arial">As we have discussed in 
the introduction part, this tutorial is split in to two parts, I assume you have 
already read first one general introduction to COLLADA documents which is 
irrespective of any programming language <span style="color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm">Part 1: 
COLLADA documents.</a></span> &nbsp;Now we would define the structure in which we can read 
the COLLADA document. Please bear in mind that this exporter which I have written in 
C# is one of my worst ever codes, I wrote everything very quick and didn't had 
any time to plan and design before code. So you will see a lot of hacks every 
where :) but it is of course recommended that you write your own exporter. One 
other thing you should remember is that, this part of part 2 will try to read 
the COLLADA document but will not change the structure (schema) of the data; every 
thing is read as it is from COLLADA, and when we will write our custom format 
out of it, we will just read those things which are really necessary.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;
</span></p>
<a name="First_Part"></a>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Reading 
Geometry Data from COLLADA document</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600">
<a href="http://www.wazim.com/Collada_Tutorial_1.htm#First_Part">Click 
here to go to: Introduction section in part 1, for this section of part 2</a></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction 
section of part 1, we discussed the following libraries and nodes which are 
related to this section and which will be parsed and used,</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;library_geometries&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;geometry&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;mesh&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;souce&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;technique_common&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;float_array&gt; and &lt;NAME_array&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;accessor&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;param&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;triangles&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;vertices&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;input&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;p&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Now you might know that 
some of the nodes are part of the Core COLLADA, which means, that they can 
appear in many places and many libraries in COLLADA. So you should define a 
structure for those nodes with common names so that they can be used for all 
kinds of purposes, for example a &lt;source&gt; node can be used for Vertices, 
Animation, Texture Coordinates and Vertex Weights or any other kinds of data. 
This is something that I forgot in my C# implementation, and later I was not 
able to re-factor :) Remember my hacky bits of code :).</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">So if I were to define a 
class in which I can read the Geometry data of a COLLADA document I would do 
something like follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class COLLADA</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">private</span><span style="font-size: 12.0pt; color: #333333">:</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">GeometryLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_GeometryLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Where GeometryLibrary 
would be defined as follows.</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class GeometryLibrary</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Geometry&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Geometries</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">And now we define Geometry as follows.</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Geometry</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Mesh</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Mesh</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The rest of the Libraries 
are not important at this point so we will not discuss them. All the other types 
of classes which are needed to store different nodes from COLLADA are listed as 
follows. And this is the simplest implementation you can make. I am not 
considering optimizations and inheritance etc. and there might be a lot of 
opportunities for restructuring and optimizations. For example as we know a 
source can have one type of array node, which could be &lt;float_array&gt;, 
&lt;NAME_array&gt; or any other type of array, in my implementation I am using 
different classes for each, you might want to create one class called Array or 
BaseArray and then derive each type of Array from it with specialize values.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Float_Array</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned int&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp; m_Count</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp; m_ID</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">float&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp; *</span><span style="font-size: 12.0pt; color: gray">m_Floats</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Name_Array</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned int</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Count</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray"> m_ID</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #333333">&nbsp; *</span><span style="font-size: 12.0pt; color: gray">m_Names</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Param</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Name</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Type</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Accessor</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_Source</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_Count</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_Stride</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">Vector&lt;Param&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray"> m_Params</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Technique_Common</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">Accessor</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Accessor</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Source</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_ID</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Float_Array&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_Float_Array</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Name_Array&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp; m_Name_Array</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Technique_Common</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_TechniqueCommon</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Input</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Semantic</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Source</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: gray">m_Offset</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: gray">m_Set</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Vertices</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">&nbsp; m_ID</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Input&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Inputs</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class P</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray"> m_Count</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: gray">m_Indices</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Triangles</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">unsigned int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_Count</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp; &nbsp;string&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Material</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Input&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_Inputs</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_P</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Mesh</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Source&gt;</span><span style="font-size: 12.0pt; color: black"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: gray">m_Sources</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vertices</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Vertices</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Triangles&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Triangles</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #339966">//----------------------------------------------//</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: #333333">&nbsp;</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">Now using those files we 
will store the Geometry data from COLLADA documents in a COLLADA Class Object. How 
you can read all those nodes is another story, you can either use C#'s XML 
parsers or use TinyXML or any other XML parser to load and parse COLLADA 
documents, 
you can also write your own XML parser if you have enough time. But I would 
suggest using an existing one rather writing your own, since the goal is to read 
COLLADA documents not XML files.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">By now you should have all 
the Data related to displaying the model in 3D scene, you can start from 
&lt;triangles&gt; node and render all the triangles using OpenGL.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<a name="Second_Part"></a>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Reading Texture 
filename from COLLADA document</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm#Second_Part">Click 
here to go to: Introduction section in part 1, for this section of part 2</a></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction 
section of part 1, we discussed the following libraries and nodes which are 
related to this section and which will be parsed and used,</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;library_images&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;image&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;init_from&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Its all again up to you 
how you want to read the texture file name, once you know where to find it. In 
the simplest form I would create a class for LibraryImages as well in the 
COLLADA Class and read the &lt;image&gt; in to it and so on. So the refined 
implementation for Class COLLADA will become as follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class COLLADA</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">private</span><span style="font-size: 12.0pt; color: #333333">:</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">GeometryLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; &nbsp;</span><span style="font-size: 12.0pt; color: gray">m_GeometryLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; ImagesLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_ImagesLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Where ImagesLibrary would 
be defined as follows.</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class ImagesLibrary</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Image&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_Images</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">And now we define Image as follows.</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Init_From</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; string</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Filename</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Image</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Init_From</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Init_From</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<a name="Third_Part"></a>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Reading 
Materials from COLLADA document</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm#Third_Part">Click 
here to go to: Introduction section in part 1, for this section of part 2</a></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction 
section of part 1, we discussed the following libraries and nodes which are 
related to this section and which will be parsed and used,</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;triangles&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;library_materials&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;material&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;instance_effect&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;library_effects&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;effect&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;phong&gt; or 
&lt;blin&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;profile_COMMON&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;technique&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;ambient&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;diffuse&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;specular&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;emission&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;shininess&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;transparency&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;color&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">If you have read the 
previous sections of this part 2, and introduction part for this section you 
should be able to define the structure for this section by yourself, so I will 
not discuss it, since its getting repeated.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<a name="Fourth_Part"></a>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Reading 
Skeleton from COLLADA document</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm#Fourth_Part">Click 
here to go to: Introduction section in part 1, for this section of part 2</a></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction 
section of part 1, we discussed the following libraries and nodes which are 
related to this section and which will be parsed and used,</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;library_visual_scenes&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;node&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;instance_controller&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;skeleton&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;visual_scene&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;matrix&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction part 
we discussed how to read the skeleton from &lt;visual_scene&gt; so I assume you should 
be able to define the structure for reading that data. But I used another 
approach myself. Which I think is the simplest way of reading Skeleton from 
COLLADA documents. And before discussing that, you need to read the next section in 
the introduction part.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<a name="Fifth_Part"></a>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Reading 
Skinning information from COLLADA document</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm#Fifth_Part">Click 
here to go to: Introduction section in part 1, for this section of part 2</a></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction 
section of part 1, we discussed the following libraries and nodes which are 
related to this section and which will be parsed and used,</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;library_controllers&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;controller&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;skin&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;source&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;param&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;accessor&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;technique_common&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;NAME_array&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;float_array&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;node&gt;.</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;vertex_weights&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;input&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;vcount&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;v&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">What I do for reading the 
skeleton from COLLADA documents is that I read the &lt;controller&gt;, and for all the 
Bone SIDs I check in the Visual Scene and find his parent and Joint Matrix, 
there, and I read the Inverse Bind matrix from the &lt;controller&gt;. And thats all 
what we need. As you might remember we took an assumption that all the joints 
must be attached to the skin. In that case you don't have to read the 
&lt;instance_controller&gt; node in the &lt;visual_scene&gt; and you can read Bone IDs from 
&lt;controller&gt; and find them in &lt;visual_scene&gt;. It require a little work to find 
the node in &lt;visual_scene&gt; and find his parent etc, but once you have started 
working with COLLADA nodes it should not be hard for you.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<a name="Sixth_Part"></a>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Reading 
Animation data from COLLADA document</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #FF6600"><a href="http://www.wazim.com/Collada_Tutorial_1.htm#Sixth_Part">Click 
here to go to: Introduction section in part 1, for this section of part 2</a></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-family: Arial">In the introduction 
section of part 1, we discussed the following libraries and nodes which are 
related to this section and which will be parsed and used,</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;library_animations&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;animation&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;source&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;sampler&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">&lt;channel&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #003366">
&lt;visual_scene&gt;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">By now you should be quite 
an expert to define structure for loading this data in to it. But I would also 
give you a hint. Your COLLADA Class should look as follows, after reading all 
those sections.</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class COLLADA</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">private</span><span style="font-size: 12.0pt; color: #333333">:</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">GeometryLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; &nbsp;</span><span style="font-size: 12.0pt; color: gray">m_GeometryLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; ImagesLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_ImagesLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; EffectsLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; &nbsp; </span><span style="font-size: 12.0pt; color: gray">m_EffectsLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; MaterialLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_MaterialLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; ControllerLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;  </span><span style="font-size: 12.0pt; color: gray">m_ControllerLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; AnimationLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_AnimationLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; VisualSceneLibrary</span><span style="font-size: 12.0pt; color: black">&nbsp; </span><span style="font-size: 12.0pt; color: gray">m_VisualSceneLibrary</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Where AnimationLibrary 
would be defined as follows and all the other libraries must have been defined 
by you.</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class AnimationLibrary</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;Animation&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: gray">m_Animations</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">And now we define Animation as follows.</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class Animation</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; string</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_ID</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;source&gt;</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Sources</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;sample&gt;</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_Samples</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp; Vector&lt;channel&gt;</span><span style="font-size: 12.0pt; color: gray">&nbsp;&nbsp;&nbsp;&nbsp; m_Channels</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">And now you should be able 
to define "sample" and "channel" classes. You can also write a structure where 
you do some other processing already on these &lt;animation&gt; nodes, and only keep 
the list of channels, where you reference the sampler targeted by this channel 
and then in "sample" you save references to the &lt;sources&gt; that are targeted or 
used by that sample. This processing we have to do sooner or later so it's your 
choice when and where you want to do it. But as we discussed in the beginning of 
this part, that we will not change the structure of COLLADA but read as it is so 
you might not want to do it now.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Please not that I am not 
giving you actual code for reading from COLLADA documents, since that depends on 
what language you use to read XML files. If you have read the first part of 
these tutorials and you have created the structure properly, you should be able 
to read the data very easily using any XML parser. So I will not go in that much 
detail of implementation. And will let you do the job yourself.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Once we have finished 
reading the COLLADA document, we are ready to write the CBA file, which will be 
explained in the following section, in case you don't want to write CBA file you 
can write your own "what ever" format and then read it accordingly.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">CBA file format</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The CBA file format is a 
very easy and simple to read and write file format. Geometry and skeletal data 
i.e. Vertex Weights etc, is saved in index form, which means, the whole data is 
saved once in a long floats array and then that float array is referenced with 
indices from the places where the data is needed. This saves space when you 
don't want to save repeated vertex attributes for example. In a typical 3D model 
one vertex can be used by many triangles, and instead of saving that vertex many 
times for each triangle, its better to save it once and save its index for each 
triangle. Thats how all the data is saved in COLLADA and CBA file will use the 
same structure since it saves a lot of space as well as sending this data to 
OpenGL is also easy and efficient.</span></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">&nbsp;</span></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">The CBA file 
format header</span></p>
<p class="MsoNormal"><span style="font-family: Arial">You can see in figure 1, 
how the header for CBA file looks.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/CBAHeader.jpg" width="590" height="700" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 1: 
Header of CBA file</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The structure of the 
header, 96 bytes in total, in source code is as follows </span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CCBAHeader</span>&nbsp;&nbsp; </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// CBA 
Main Chunk contains information about all other chunks (32 Bytes in Total)</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">class</span>
<span style="color: blue">CCBAMainChunk</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_MagicNumber</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Always CBA0</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int&nbsp; </span><span style="color: #808080">m_ChunkID</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Must be 0&nbsp; </span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_Version</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Version initial 1, In this version only supports 
GeometryChunk</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_NoOfSubChunks</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Total Number of Chunks</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_HasAnimation_HasSkeleton</span>;&nbsp;
<span style="color: green">// LowBytes = Animation, HighBytes = Skeleton</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_FirstChunkOffset</span>;&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// From where does the First Chunk Starts</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_FileSize</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Total number of Bytes in the File</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_ExtraData</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Can be any number of Bytes after this bytes</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; };</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p class="MsoNormal" style="text-indent: .5in; text-autospace: none">
<span style="font-family: Courier New; color: green">// Contains the Bind 
Position Geometry Data in CBA (40 Bytes in Total)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">class</span>
<span style="color: blue">CCBAGeometryChunk</span> </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_TotalNoOfTriangles</span>;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Total Triangles</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_ChunkID</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Must be 1&nbsp; </span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_NoOfTriangleGroups</span>;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Number of Triangle Groups Categorized by 
Material</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_TrianglesDetails</span>; &nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// 1 = Only Vertices, 2 = Vertices + Normals, 3 
= Vertices + Normals + TextureCoords</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_DataOffset</span>; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Actual Data Starts from this Offset</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">char
</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #808080">m_TextureFileName</span><font color="#808080">[20]</font>;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Texture files name (.jpg,.png,.tga,.bmp)&nbsp;&nbsp; </span>
</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; };</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// 
Contains the Animation Data in CBA (24 Bytes in Total)</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">class</span>
<span style="color: blue">CCBAAnimationChunk</span> </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int&nbsp; </span><span style="color: #808080">m_NoOfAnimations</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Total Animations Keyframes</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_ChunkID</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Always 2</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned int</span>&nbsp; <span style="color: #808080">m_NoOfKeyframes</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Total Animations Keyframes</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">&nbsp;&nbsp;&nbsp; </span><font color="#808080">m_StartTime</font>;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Start Time of the animation</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #808080">m_TotalTime</span>;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// End time or total time of the animation</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">&nbsp;&nbsp;&nbsp;&nbsp;</span><font color="#808080">m_FramesPerSecond</font>; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Frames Per second to render</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; };</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CCBAMainChunk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #808080">m_MainChunk</span>;&nbsp;
<span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // The Main Chunk of CBA file</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CCBAGeometryChunk</span>&nbsp; <span style="color: #808080">m_GeometryChunk</span>;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">&nbsp;&nbsp;&nbsp; // The Geometry Chunk of CBA file</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CCBAAnimationChunk</span> <span style="color: #808080">m_AnimationChunk</span>;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">&nbsp;&nbsp;&nbsp; // The Animation Chunk of CBA file</span></span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Immediately, after the 
header is finished, the actual data of the CBA file format starts. </span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/CBAData.jpg" width="633" height="900" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 2: 
Data section of CBA file</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">As you can see the data 
section of the CBA file format is very simple. The first four elements are the 4 
arrays we need which are saved in index form.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">First one is the Vertices 
data, which says number of vertices in a 4 byte integer, and the actual data in 
4 byte floats array.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Second one is the Normals 
data, which says number of Normals in a 4 byte integer, and the actual data in 4 
byte floats array.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Third one is the Texture 
Coordinates data, which says number of Texture Coordinates in a 4 byte integer, 
and the actual data in 4 byte floats array.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Fourth one is the Vertex 
weights data, which says number of Vertex Weights in a 4 byte integer, and the 
actual data in 4 byte floats array.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">After that we have the 
triangle group's data, we already know how many triangle groups we have from the 
header so for each triangle group we save its number of triangles in a 4 bytes 
unsigned integer and second we save its material which is 4, 4 component vectors 
and 2 floats. In total 72 bytes for material. After that we save the triangles 
indices for each triangle, which are 3 unsigned shorts (1 for each vertex) per 
each attribute. So for a triangle which specifies Vertex, Normal and Texture 
Coordinate, we save 3 * 3 = 9 indices.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">After the triangles data 
we write the Skeleton data, first we write the bind shape matrix for the 
skeleton. Then for each Joint we write its Parent ID, Joint Matrix, (which is 
called Bind matrix in the figure) and its inverse bind matrix. Remember we are 
not writing the Bone ID itself, in the skeleton, which can be considered as the 
number/index of the bone we read, so the first bone we read gets an ID of 0, the 
second one gets an ID of 1 and so on.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">After the skeleton we have 
the weighted vertices data. For each vertex from the vertices source in the 
Geometry data section, we have to specify its weight towards any bone. So for 
each vertex we write the number of bones affecting this vertex, and then for 
each bone affecting this vertex, we write the Joint ID/Bone ID and the weight 
towards that bone.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">And at the end we write 
the Animations key frame data. As you might have noticed that the animation 
nodes are targeting Joints from the skeleton and this was one of our assumptions 
that only skeletal animation is supported and not backed animations or vertex 
animation. So for each Bone/Joint targeted by the animations from the library 
animations we write it's Bone ID and then its number of key frames, which 
consists of "time" and a Joint Matrix, which is called "transform" in the 
figure.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">And thats the whole CBA 
file format. In the next part you will learn how to create this Character in 
OpenGL scene that we saved in CBA files, how to connect it to the skeleton and 
how to animate it.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><b><span style="font-size: 14.0pt; font-family: Arial">Part 
2.2:</span></b></p>
<p class="MsoNormal"><b><span style="font-size: 14.0pt; font-family: Arial">
Implementation part; skeletal animation in C++ using OpenGL</span></b></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">Implementation 
of Skeletal Animation in C++</span></p>
<p class="MsoNormal"><span style="font-family: Arial">At last we are here :) for 
which we were waiting. This part of the tutorials is the most important of all 
the other parts we have read so far. We will first try to write the 
implementation for loading the CBA file that we wrote before in C#. You can also 
download this CBA loading API from downloads section of this website.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The API has a CCBA class 
which handles loading and displaying of the CBA files, which looks like follows.</span></p>
<p class="MsoNormal"><span style="font-size: 14.0pt; font-family: Arial">&nbsp;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">class</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: blue">CCBA</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">public</span><span style="font-size: 12.0pt; color: #333333">:</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">CCBA</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">void</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #333333">~</span><span style="font-size: 12.0pt; color: blue">CCBA</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">void</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Some of the Functions are excluded from this text for the sake of simplicity</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">Draw</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">Update</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">unsigned long</span><span style="font-size: 12.0pt; color: black"> a_MiliSeconds</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">SetupSkeleton</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">int</span><span style="font-size: 12.0pt; color: black"> a_Frame</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">SetupBindPose</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ReadCBA</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black"> a_FileName</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">protected</span><span style="font-size: 12.0pt; color: #333333">:</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ReadHeader</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">CExport</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: black">a_File</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black"> a_FileName</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ReadArray</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">CExport</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: black">a_File</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: blue">float</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">**</span><span style="font-size: 12.0pt; color: black">a_Destination</span><span style="font-size: 12.0pt; color: #333333">,</span><span style="font-size: 12.0pt; color: blue">unsigned int</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">&amp;</span><span style="font-size: 12.0pt; color: black">a_Size</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ReadTriangles</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">CExport </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: black">a_File</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ReadSkeleton</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">CExport</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: black">a_File</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ReadAnimations</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">CExport</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: black">a_File</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">WriteCBA</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black"> a_FileName</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">CalculateBound</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #993300">ConvertToArrays</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">private</span><span style="font-size: 12.0pt; color: #333333">:</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; // Only the most important member variables are shown here </span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">CCBAHeader&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: #333333">*</span><font color="#808080"><span style="font-size: 12.0pt; ">m_Header</span></font><span style="font-size: 12.0pt; color: #333333">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Header (Contains information about the file)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">CGeometryData</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: #333333">*</span><font color="#808080"><span style="font-size: 12.0pt; ">m_GeometryData</span></font><span style="font-size: 12.0pt; color: #333333">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Common data in the Mesh (List of Vertices/Normals/TexCoords)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">CSkeletonData</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: #333333">*</span><font color="#808080"><span style="font-size: 12.0pt; ">m_SkeletonData</span></font><span style="font-size: 12.0pt; color: #333333">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Skeleton Data used for animation</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">Vector&lt;CTriangleGroup*&gt;</span><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;*</span><font color="#808080"><span style="font-size: 12.0pt; ">m_TrianglesGroups</span></font><span style="font-size: 12.0pt; color: #333333">;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Individual Triangle Groups Separated By Material Data (Just Indices and Material)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #333333">};</span></pre>
<p class="MsoNormal" style="text-align: justify; text-justify: kashida; text-kashida: 0%">
<span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In the CCBA class the most 
important member variables are </span><span style="color: #333333">m_Header</span><span style="font-family: Arial">,
</span><span style="color: #333333">m_GeometryData</span><span style="font-family: Arial">,
</span><span style="color: #333333">m_SkeletonData</span><span style="font-family: Arial"> 
and </span><span style="color: #333333">m_TriangleGroups</span><span style="font-family: Arial"> 
the rest of the stuff is provided for the sake of completeness. As the names 
suggests, </span><span style="color: #333333">m_Header</span><span style="font-family: Arial"> 
contains the Header, </span><span style="color: #333333">m_GeometryData</span><span style="font-family: Arial"> 
will contain the Geometry of the Character, </span><span style="color: #333333">
m_SkeletonData</span><span style="font-family: Arial"> will contain the Joints 
Hierarchy, and </span><span style="color: #333333">m_TriangleGroups</span><span style="font-family: Arial"> 
contains all the Triangle groups which are separated by Material, by the COLLADA 
Exporter from StudioMax.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The </span>ReadCBA<span style="font-family: Arial"> 
function of CCBA class looks like this.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">void</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: blue">CCBA</span><span style="font-size: 12.0pt; color: #333333">::</span><span style="font-size: 12.0pt; color: #993300">ReadCBA</span><span style="font-size: 12.0pt; color: #333333">( </span><span style="font-size: 12.0pt; color: blue">string</span><span style="font-size: 12.0pt; color: black"> a_FileName </span><span style="font-size: 12.0pt; color: #333333">)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">{</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">CExport</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: #333333">*</span><span style="font-size: 12.0pt; color: black">File </span><span style="font-size: 12.0pt; color: #333333">= </span><span style="font-size: 12.0pt; color: blue">new</span><span style="font-size: 12.0pt; color: black"> </span><span style="font-size: 12.0pt; color: blue">CExport</span><span style="font-size: 12.0pt; color: #333333">(0,</span><span style="font-size: 12.0pt; color: black">a_FileName</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadHeader</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: black">a_FileName</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Header</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadArray</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">, &amp;</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_VerticesArray</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_VerticesArraySize</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Points</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadArray</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">, &amp;</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_NormalsArray</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_NormalsArraySize</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Normal</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadArray</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">, &amp;</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_TextureCoordsArray</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_TextureCoordsArraySize</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Texture Coordinates</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">if </span><span style="font-size: 12.0pt; color: #333333">(65536 &amp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_Header</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_MainChunk</span><span style="font-size: 12.0pt; color: #333333">.</span><span style="font-size: 12.0pt; color: black">m_HasAnimation_HasSkeleton</span><span style="font-size: 12.0pt; color: #333333">)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadArray</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">, &amp;</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_VertexWeightsArray</span><span style="font-size: 12.0pt; color: #333333">, </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_GeometryData</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_VertexWeightsArraySize</span><span style="font-size: 12.0pt; color: #333333">);</span><span style="font-size: 12.0pt; color: green">// Read Weights Data</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadTriangles</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Triangles Data</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">if </span><span style="font-size: 12.0pt; color: #333333">(65536 &amp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_Header</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_MainChunk</span><span style="font-size: 12.0pt; color: #333333">.</span><span style="font-size: 12.0pt; color: black">m_HasAnimation_HasSkeleton</span><span style="font-size: 12.0pt; color: #333333">)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; {</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadSkeleton</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Skeleton Data</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadAnimations</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">File</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Animations Data</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">SetupInverseBindAttributes</span><span style="font-size: 12.0pt; color: #333333">(); </span><span style="font-size: 12.0pt; color: green">// Extra Processing for setting up for Skinning</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; }</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">delete</span><span style="font-size: 12.0pt; color: black"> File</span><span style="font-size: 12.0pt; color: #333333">;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ReadClipsInformation</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">a_FileName</span><span style="font-size: 12.0pt; color: #333333">); </span><span style="font-size: 12.0pt; color: green">// Read Animation Clips</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: green">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">CalculateBound</span><span style="font-size: 12.0pt; color: #333333">(); </span><span style="font-size: 12.0pt; color: green">// Calculates Bounding Sphere</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">if </span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_Header</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: black">m_MainChunk</span><span style="font-size: 12.0pt; color: #333333">.</span><span style="font-size: 12.0pt; color: black">m_Version </span><span style="font-size: 12.0pt; color: #333333">== 1) </span><span style="font-size: 12.0pt; color: green">// CBA Version 1 is changed to 2</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; {</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">ConvertToArrays</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">WriteCBA</span><span style="font-size: 12.0pt; color: #333333">(</span><span style="font-size: 12.0pt; color: black">a_FileName</span><span style="font-size: 12.0pt; color: #333333">);</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">DuplicateSkinnedData</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; }</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">else</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">DuplicateBackupData</span><span style="font-size: 12.0pt; color: #333333">();</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">FillVertexBufferObject</span><span style="font-size: 12.0pt; color: #333333">(); </span><span style="font-size: 12.0pt; color: green">// Makes it Ready to be rendered </span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">FillIndexBufferObject</span><span style="font-size: 12.0pt; color: #333333">();&nbsp; </span><span style="font-size: 12.0pt; color: green">// Makes it Ready to be rendered</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: blue">this</span><span style="font-size: 12.0pt; color: #333333">-&gt;</span><span style="font-size: 12.0pt; color: #993300">SetupTexture</span><span style="font-size: 12.0pt; color: #333333">(); </span><span style="font-size: 12.0pt; color: green">// Sets up Texture and loads</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: #333333">}</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">You can see that the 
function is quite simple; its just reading the sections that we discussed 
before. For example it reads header, and all arrays, and then reads Triangles 
etc. One thing that I would like to explain here is that the exporter that we 
discussed before write a CBA version 1.0, which means all the data is saved as 
it is as we read from COLLADA. In ReadCBA function we check if the CBA version 
is 1.0 then we convert it to CBA Version 2.0. And before doing that, 
ConvertToArrays() is called, which takes all the arrays from CBA and makes them 
ready to be used with OpenGL Vertex Buffers and Index Buffers. The Difference 
between these two types is that, for example we have one triangle in COLLADA and 
it has 3 Attributes per vertex. So each vertex of a triangle in COLLADA has 1 
Index per Attribute, and 3 indices for 3 attributes. While OpenGL Vertex Buffers 
can only read One Index per vertex for any number of attributes. For that 
purpose we have to do some extra processing on the data arrays to shuffle them 
so that each vertex used in a triangle has same Index for all its attributes 
from the attributes sources. And then we resave this new CBA file as Version 
2.0. If you dont understand this process, then dont worry and keep on reading 
because you need this step only if you want to render the mesh using OpenGL 
vertex and index buffers. If you want to render everything in immediate mode 
then you dont have to worry about that.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The rest of the functions 
are self explanatory, each one of them reads the corresponding section from CBA 
files, and if I try to explain each and every one of them separately it will 
easily get very boring.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The main purpose of 
ReadCBA is to read the CBA file and fill the data structures that we created for 
saving the Character data. We have already discussed the header structure of CBA 
file. Now we will discuss the rest of the data structures that we save.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">CGeometryData	</span><span style="font-size: 12.0pt; color: #333333">*m_GeometryData;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Common data in the Mesh (List of Vertices/Normals/TexCoords)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: green">&nbsp;</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">CGeometryData class 
contains all the Data that we need for the Character other then Skeleton and 
Animations data. And it looks like follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CGeometryData</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CGeometryData</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CGeometryData</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">
//Functions for this class are removed</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_VerticesArray</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// All the Vertices</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_SkinnedVerticesArray</span>;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// All the Skinned Vertices</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_NormalsArray</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// All the Normals</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_SkinnedNormalsArray</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// All the Skinned Normals</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_TextureCoordsArray</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// All the Texture Coordinates</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: #808080">m_VertexWeightsArray</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// All the Vertex Weights</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">Vector</span>&lt;<span style="color: blue">CVertexInfluence</span>*&gt;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_VertexInfluences</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Vertices Influences</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int&nbsp; </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">&nbsp;</span><font color="#808080">m_VerticesArraySize</font>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<span style="color: #808080">m_NormalsArraySize</span><span style="color: blue">;</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">&nbsp;&nbsp;&nbsp;&nbsp; unsigned 
int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<span style="font-family: Courier New; color: #808080">
m_TextureCoordsArraySize</span><span style="font-family: Courier New; color: blue">;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">&nbsp;&nbsp;&nbsp;&nbsp; unsigned int&nbsp; </span>
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
&nbsp;</span><font color="#808080">m_VertexWeightsArraySize</font>;</span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">We will read all the 
Vertices, Normals, Texture coordinates and Vertex Weights arrays in this 
m_GeometryData pointer. If you see we also have Duplicated copies of both the 
Vertices array and Normals array. These copies are used during skinning and will 
be explained later. Since the Vertex Texture coordinates and vertex weights 
never change during skinning, we dont need copies of them.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Apart from all that, we 
have a list of CVertexInfluence pointers for each model. This is the list where 
we save the data regarding which bone is influencing which vertex with how much 
weight. The structure of CVertexInfluence is as follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CVertexInfluence</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CVertexInfluence</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CVertexInfluence</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #808080">m_NoOfInfluences</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green"> // Total Number of Influences</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: #808080">m_Weights</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Weights Array</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_Joints</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Joints Array</span></span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The next thing in CCBA is;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">CSkeletonData</span><span style="font-size: 12.0pt; color: black">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: #333333">*</span><font color="#808080"><span style="font-size: 12.0pt; ">m_SkeletonData</span></font><span style="font-size: 12.0pt; color: #333333">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 12.0pt; color: green">// Skeleton Data used for animation</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: green">&nbsp;</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">This is where the skeleton 
data is saved and the structure of the CSkeletonData is as follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CSkeletonData</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CSkeletonData</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CSkeletonData</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp; <span style="color: #808080">m_NoOfBones</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">&nbsp;&nbsp;&nbsp; // Total Number of Joints in Skeleton</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp; <span style="color: #808080">m_NoOfKeyframes</span>;&nbsp;
<span style="color: green">&nbsp;&nbsp;&nbsp; // Another Copy of the No Of Key frames of animation</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMatrix4f</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_BindShapeMatrix</span>; <span style="color: green">
&nbsp;
// Bind Shape Matrix</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CBone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
**<span style="color: #808080">m_Bones</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">
&nbsp;&nbsp;
// All the bones</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CBone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_RootBone</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">
&nbsp;&nbsp;
// Root bone reference to one of the Bone in the m_Bones</span></span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: green">&nbsp;</span></pre>
<p class="MsoNormal"><span style="font-family: Arial">Here we save all the bones 
and the bones contain the hierarchy information. We have the Bind Shape Matrix, 
and a bone count. How each bone is structures is as follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CBone</span> </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CBone</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CBone</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #808080">m_ID</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// ID of this bone</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #808080">m_ParentID</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Parent ID of this bone</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMatrix4f</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_JointMatrix</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// The Bind Pose Matrix</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMatrix4f</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_InverseBindMatrix</span>;&nbsp;&nbsp;<span style="color: green">// The Inverse Bind Pose Matrix</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMatrix4f</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_WorldMatrix</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// The World Matrix</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMatrix4f</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_SkinningMatrix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// The Matrix Used for calculations</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp; <span style="color: #808080">m_ChildCount</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// Number of Children</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">Vector</span>&lt;<span style="color: blue">int</span>&gt;&nbsp;&nbsp; 
*<span style="color: #808080">m_Children</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// Children of this bone</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp; <span style="color: #808080">m_NoOfKeyframes</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: green">// No Of key frames of animation for this bone</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CKeyframe</span>&nbsp;&nbsp;&nbsp;&nbsp; 
**<span style="color: #808080">m_Keyframes</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// All Key frames for this Bones animation</span></span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Here we have the Bone ID, 
Parent Bone ID, Joint Matrix, Inverse Bind Matrix, all the Child bone IDs and 
all the key frames for this bone. World Matrix and Skinning Matrix are created 
and changed at run time when we run the animation, so they are just convenience 
buffers. Each key frame is a pair of Transformation (Joint Matrix) and time.</span></p>
<p class="MsoNormal"><span style="font-size: 14.0pt; font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CKeyframe</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CKeyframe</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CKeyframe</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">&nbsp;</span><font color="#808080">m_Time</font>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// Time of this key frame</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMatrix4f</span> 
&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: #808080">m_Transform</span>; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// Transformation of this Key frame</span></span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<p class="MsoNormal"><span style="font-size: 10.0pt; font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The next very important 
thing in CCBA is;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">Vector&lt;CTriangleGroup*&gt;</span><span style="font-size: 12.0pt; color: #333333"> *</span><font color="#808080"><span style="font-size: 12.0pt; ">m_TrianglesGroups</span></font><span style="font-size: 12.0pt; color: #333333">;</span><span style="font-size: 12.0pt; color: green">// Individual Triangle Groups Separated By Material Data (Just Indices and Material)</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="color: blue">&nbsp;</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; font-family: Arial">The Structure of a CTriangleGroup is as follows</span><span style="font-family: Arial">.</span></pre>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-family: Arial">&nbsp;</span></pre>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CTriangleGroup</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-indent: .5in; text-autospace: none">
<span style="font-family: Courier New; color: blue">CTriangleGroup</span><span style="font-family: Courier New">(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CTriangleGroup</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; // The functions for 
this class are removed</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CTriangle</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_Triangles</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CMaterial</span>&nbsp;&nbsp;&nbsp;&nbsp; 
*<span style="color: #808080">m_Material</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned 
int</span>&nbsp; <span style="color: #808080">m_NoOfTriangles</span>;</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt">};</span></pre>
<p class="MsoNormal"><span style="font-size: 10.0pt; font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">This class is used for 
saving the triangles data from CBA file as well as the material information for 
each triangle group. For the sake of completeness the structure of CTriangle is 
also presented, which is used to save 9 indices for 3 vertices and their 3 
attributes of each vertex of a triangle.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">class</span><span style="font-family: Courier New">
<span style="color: blue">CTriangle</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">public</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">CTriangle</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; ~<span style="color: blue">CTriangle</span>(<span style="color: blue">void</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; // The functions for 
this class are removed</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">private</span><span style="font-family: Courier New">:</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned</span><span style="color: black">
</span><span style="color: blue">short</span>&nbsp;&nbsp;&nbsp;&nbsp; 
<span style="color: #808080">
m_VerticesIndex</span>[3];</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned</span><span style="color: black">
</span><span style="color: blue">short</span>&nbsp;&nbsp;&nbsp;&nbsp; 
<span style="color: #808080">
m_NormalsIndex</span>[3];</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">unsigned</span><span style="color: black">
</span><span style="color: blue">short</span>&nbsp;&nbsp;&nbsp;&nbsp; 
<span style="color: #808080">
m_TexturesIndex</span>[3];</span></p>
<p class="MsoNormal"><span style="font-family: Courier New">};</span></p>
<p class="MsoNormal"><span style="font-size: 10.0pt; font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">And thats all the data 
structures that we need to read the Character in. Now all what we have to do is 
to, use this data and make our character animate. Which is done half in setting 
up the skeleton </span>
<span style="font-size: 13.0pt; font-family: Courier New; color: black">
SetupSkeleton() </span><span style="font-family: Arial">and half in </span>
<span style="font-family: Courier New; color: black">SetupBindPose</span><span style="font-family: Courier New">().</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">How skeletal 
Animation works?</span></p>
<p class="MsoNormal"><span style="font-family: Arial">If you have come so far 
you might already know that so far we have saved data for the character in 3 
Categories, one category is the Geometry data of the Character which is saved in
</span><span style="font-family: Courier New; color: black">m_GeometryData</span><span style="font-family: Arial"> 
and </span><span style="font-family: Courier New; color: black">m_TriangleGroups</span><span style="font-family: Arial">, 
second category is the skeleton data, which is saved in </span>
<span style="font-family: Courier New; color: black">m_SkeletonData</span><span style="font-family: Arial">, 
and the Third Category is the animation data which is saved within the bones 
inside the </span><span style="font-family: Courier New; color: black">
m_SkeletonData</span><span style="font-family: Arial">. The first category of 
Geometry data can be used alone to draw the character on screen. The pose that 
you will see is called the Modeling pose, in which the character was modeled. 
Please refer to the following figure.</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/Modelpose.JPG" width="783" height="400" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 3: 
Modeling Pose of a Character</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">All you have to do to draw 
this Pose is to render all the triangles from all the triangle groups (</span><span style="font-family: Courier New; color: black">m_TriangleGroups</span><span style="font-family: Arial">) 
with texture applied.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The second category can be 
used to draw the skeleton in Bind Pose, which is the pose when the skeleton was 
attached to the skin.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/OnlySkeleton.jpg" width="152" height="400" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 4: 
Skeleton in Bind Pose</span></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">You can see in this here 
that the skeleton is ready to be used to transform the vertices of the Modeling 
pose to bring the Character in this pose. The process goes like this.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/Binding.jpg" width="868" height="428" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 5: 
Process of Binding Skeleton to the Skin</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The model is given to us 
in Modeling Pose Just like shown in Figure 5.1, we have also setup the skeleton 
in the Bind pose like shown in Figure 5.2, we need to transform all the vertices 
of the model in Figure 5.1 using the skeleton from Figure 5.2 to get the shape 
of Figure 5.3, this is done with the Skinning equation given later in the text, 
and then we render the model using textures and materials as shown in Figure 
5.4.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">The transformation for 
each bone is calculated by multiplying its Joint Matrix with the parent Bones 
World matrix. An example is given in the following figure.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;<img border="0" src="./Collada_Tutorial_2_files/Heirarchy.jpg" width="411" height="410" data-pinit="registered"></span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 6: 
Deriving the skeleton world matrices</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In this figure the World 
matrix for the red bone is calculated. We always start from the root bone, since 
the root bone doesnt have any parent; its world matrix becomes its joint 
matrix. Next we pick the next bone in the hierarchy, we get its world matrix 
from multiplication of the parent bones (root bone) world matrix (M1<sub>W</sub>) 
with this bones Joint Matrix (M2<sub>j</sub>), and this world matrix is called 
M2<sub>W </sub>in the figure. Now we move to the next bone (red bone) and to 
calculate its world matrix we multiply its parent bones World matrix (M2<sub>W</sub>) 
with the red bones Joint matrix (M3<sub>j</sub>) and we get the Red bones 
World Matrix called (M3<sub>W</sub>). This process is repeated for each bone, 
taking its parent bone world matrix and multiplying its own join matrix with it, 
and then saving the result in its own world matrix. As you can see this process 
must be started from the root bone, so that we dont have dirty world matrices 
while we go down.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In this model most of the 
vertices are influenced by more then one bone, and the influence is denoted by 
the weight associated with each vertex toward each bone that influences it. 
Without this the animation looks very rigid. Example of vertices affected by 
only one bone is given as follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/Weights0.jpg" width="475" height="300" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 7: 
Vertices only effected by one bone</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Example of vertices 
affected by more then one bone is given as follows.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/Weights.jpg" width="430" height="300" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 8: 
Vertices effected by more then one bone</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In the following figure 
you can see how the vertex weights are distributed over the vertices. Red Color 
vertices means high influence from the red bone, while blue color means less 
influence from the selected Bone (red bone), the colors in between red and blue 
are used for weight values between zero and one.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/Weights2.jpg" width="441" height="334" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 9: 
Vertices affected with different weights by the red bone</span></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In the following sections 
you will see how the weights of each bone affecting a vertex are accumulated to 
get the final vertex position.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">And the Final and Third 
category is the Animations data. We use the animation data to move the Skeleton 
of the character in different poses and then use that new pose generated by the 
animation data to transform the vertices of the character and draw in new pose. 
So all what the animation data do is to animate the skeleton and we use the 
animated skeleton to animate our character.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal">
<img border="0" src="./Collada_Tutorial_2_files/Animation.jpg" width="908" height="300" data-pinit="registered"></p>
<p class="MsoNormal"><span style="font-family: Arial; color: #993300">Figure 10: 
Animation data is applied to the skeleton to animate the skeleton</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">Here we can see that the 
Bind pose skeleton is transformed by different key frame transforms from the 
animation data, to define different poses. And then these poses are used to 
drive the skin, and transform the vertices of the character.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">This was all the theory 
behind skeletal animation, how it is done using our CBA file data is given in 
the following sections.</span></p>
<p class="MsoNormal">
<span style="font-size: 14.0pt; font-family: Arial; color: navy">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In </span>
<span style="font-family: Courier New; color: black">SetupSkeleton() </span>
<span style="font-family: Arial">we make the skeleton ready for next pose, the 
body of the function is as follows. And then we use that pose to setup our 
vertices in the new pose which is done in </span>
<span style="font-family: Courier New; color: black">SetupBindPose</span><span style="font-family: Courier New">().</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">void</span><span style="font-family: Courier New">
<span style="color: blue">CCBA</span>::<span style="color: blue">SetupSkeleton</span>(<span style="color: blue">int</span>
<span style="color: black">a_Frame</span>)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-indent: .5in; text-autospace: none">
<span style="font-family: Courier New; color: green">// Update the tree of bones</span></p>
<p class="MsoNormal" style="text-indent: .5in; text-autospace: none">
<span style="font-family: Courier New; color: blue">static</span><span style="font-family: Courier New">
<span style="color: blue">CStack</span>&lt;<span style="color: blue">int</span>&gt;
<span style="color: black">BonesStack</span>;</span></p>
<p class="MsoNormal" style="text-indent: .5in; text-autospace: none">
<span style="font-family: Courier New; color: black">BonesStack</span><span style="font-family: Courier New">.<span style="color: #993300">Push</span>(<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_RootBone</span>-&gt;<span style="color: black">m_ID</span>);</span></p>
<pre style="font-size: 10.0pt; font-family: Courier New; margin-left: 0in; margin-right: 0in; margin-top: 0in; margin-bottom: .0001pt"><span style="font-size: 12.0pt; color: blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while</span><span style="font-size: 12.0pt"> (!<span style="color: black">BonesStack</span>.</span><span style="font-size: 12.0pt; color: #993300">Empty</span><span style="font-size: 12.0pt">())</span></pre>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned</span><span style="color: black"> </span><span style="color: blue">int</span>
<span style="color: black">CurrentBone</span> = <span style="color: black">
BonesStack</span>.<span style="color: #993300">Pop</span>();</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
assert</span>(<span style="color: black">CurrentBone</span> != -1&nbsp; &amp;&amp;
<span style="color: maroon">"Current Bone is Null"</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CMatrix4f</span> <span style="color: black">WorldMatrix</span> = *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_JointMatrix</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> 
(<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_NoOfKeyframes</span> 
&gt; 0<span style="color: green">/* &amp;&amp; frame &gt; 0*/</span>)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
assert</span>(<span style="color: black">a_Frame</span> &lt; (<span style="color: blue">int</span>)<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_NoOfKeyframes</span> 
&amp;&amp; <span style="color: maroon">"Invalid Key frame"</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
float</span> <span style="color: black">InBetween</span> = (<span style="color: blue">float</span>)(<span style="color: blue">this</span>-&gt;<span style="color: black">m_AnimationTime</span> 
* (<span style="color: blue">float</span>)<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_NoOfKeyframes</span> 
/ <span style="color: blue">this</span>-&gt;<span style="color: black">m_Header</span>-&gt;<span style="color: black">m_AnimationChunk</span>.<span style="color: black">m_TotalTime</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
InBetween</span> -= <span style="color: black">a_Frame</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
if</span> (<span style="color: black">a_Frame</span> &lt;&nbsp; (<span style="color: blue">int</span>)<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_NoOfKeyframes</span> 
- 1)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">WorldMatrix</span> = <span style="color: #993300">
Interpolate</span>(*<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_Keyframes</span>[<span style="color: black">a_Frame</span>]-&gt;<span style="color: black">m_Transform</span>,</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_Keyframes</span>[<span style="color: black">a_Frame</span> 
+ 1]-&gt;<span style="color: black">m_Transform</span>,<span style="color: black">InBetween</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
else</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">WorldMatrix</span> = *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_Keyframes</span>[<span style="color: black">a_Frame</span>]-&gt;<span style="color: black">m_Transform</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> 
(<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: #993300">HasParent</span>())</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
WorldMatrix</span> = <span style="color: black">WorldMatrix</span> * *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_ParentID</span>]-&gt;<span style="color: black">m_WorldMatrix</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_WorldMatrix</span> 
= <span style="color: black">WorldMatrix</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_SkinningMatrix</span> 
= *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_InverseBindMatrix</span> 
* <span style="color: black">WorldMatrix</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// 
Handle its Children</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> 
(<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: #993300">HasChildren</span>())</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
unsigned</span><span style="color: black"> </span><span style="color: blue">int</span>
<span style="color: black">NoOfChildren</span> = <span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: black">m_ChildCount</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
for</span> (<span style="color: blue">unsigned</span><span style="color: black">
</span><span style="color: blue">int</span> <span style="color: black">Index</span> 
= 0; <span style="color: black">Index</span> &lt; <span style="color: black">
NoOfChildren</span>; <span style="color: black">Index</span>++)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">BonesStack</span>.<span style="color: #993300">Push</span>(<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[<span style="color: black">CurrentBone</span>]-&gt;<span style="color: #993300">GetChildAt</span>(<span style="color: black">Index</span>));</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; } <span style="color: green">// 
While</span></span></p>
<p class="MsoNormal"><span style="font-family: Courier New">}</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">In very short and very 
simple, all this function is doing is to take the current frame Joint Matrix for 
the current bone and if its a root bone then save that Joint matrix as world 
matrix for the current bone, other wise take the parent bones World matrix and 
multiply this bones Joint matrix with it and then save the result as current 
bones World Matrix. We have to start this process from the Root bone so that we 
dont have dirty world matrices from previous frames in the tree. This is why a 
Depth first Tree Traversal is used, using a Stack. Now for each bone we have a 
new World Matrix for the current frame of animation. And in the same function we 
use this World Matrix to derive the skinning matrix for the current bone, which 
is used in </span>
<span style="font-size: 10.0pt; font-family: Courier New; color: black">
SetupBindPose</span><span style="font-size: 10.0pt; font-family: Courier New">()
</span><span style="font-family: Arial">to do the skinning, which means to 
attach all the vertices with the skeleton and move them with the corresponding 
bones. If you see </span>
<span style="font-size: 10.0pt; font-family: Courier New; color: black">
SetupBindPose</span><span style="font-size: 10.0pt; font-family: Courier New">()</span><span style="font-family: Arial"> 
you will see in the beginning the skinning calculation equation. In that 
equation we need have </span>
<span style="font-size: 10.0pt; font-family: Courier New; color: green">(IBMi * 
JMi)</span><span style="font-family: Arial"> which means we need to multiply a 
bones Inverse Bind matrix with its World matrix so thats what is done in
</span><span style="font-size: 10.0pt; font-family: Courier New; color: black">
SetupSkeleton() </span><span style="font-family: Arial">and the result is saved 
in advance in </span>
<span style="font-size: 10.0pt; font-family: Courier New; color: black">
m_SkinningMatrix</span><span style="font-family: Arial"> for each bone, with 
this we dont have to do this multiplication for each and every vertex we need 
to skin to the skeleton. One other thing which we can do before hand is the
</span><span style="font-size: 10.0pt; font-family: Courier New; color: green">
(v * BSM)</span><span style="font-family: Arial"> which is the multiplication of 
each vertex with the Bind Shape matrix of the skeleton. So we do that once and 
then use the updated vertices. The actual skinning is done in the following 
function.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: blue">void</span><span style="font-family: Courier New">
<span style="color: blue">CCBA</span>::<span style="color: #993300">SetupBindPose</span>()</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">{</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">/*</span></span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; The skinning 
calculation for each vertex v in a bind shape is</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; for i to n</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v += {[(v * BSM) 
* IBMi * JMi] * JW}</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp;  n: The number of 
joints that influence vertex v</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp;  BSM: Bind-shape 
matrix</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp;  IBMi: Inverse 
bind-pose matrix of joint i</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp;  JMi: Transformation 
matrix of joint i</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp;  JW: Weight of the 
influence of joint i on vertex v</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; I have Got (v * BSM) 
and (IBMi * JMi) already multiplied since they are constants</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; */</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">rUsInt</span>
<span style="color: black">NumberOfVertices</span> = <span style="color: blue">
this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VerticesArraySize</span> 
/ 3;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">for</span> 
(<span style="color: blue">rUsInt</span> <span style="color: black">
CurrentVertex</span> = 0; <span style="color: black">CurrentVertex</span> &lt;
<span style="color: black">NumberOfVertices</span>; <span style="color: black">
CurrentVertex</span>++)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CVector3f</span> <span style="color: black">TempVertex</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CVector3f</span> <span style="color: black">TempNormal</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CVector3f</span> <span style="color: black">TempNormalTransform</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CVector3f</span> <span style="color: black">Vertex</span>(&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VerticesArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3)&nbsp;&nbsp;&nbsp; ],</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VerticesArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 1],</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VerticesArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 2]);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">
CVector3f</span> <span style="color: black">Normal</span>(&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_NormalsArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3)&nbsp;&nbsp;&nbsp; ],</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_NormalsArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 1],</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_NormalsArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 2]);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>
<span style="color: black">TotalJointsWeight</span> = 0;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">float</span>
<span style="color: black">NormalizedWeight</span> = 0;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">for</span> 
(<span style="color: blue">rUsInt</span> <span style="color: black">
CurrentInfluence</span> = 0; <span style="color: black">CurrentInfluence</span> 
&lt; (*<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexInfluences</span>)[<span style="color: black">CurrentVertex</span>]-&gt;<span style="color: black">m_NoOfInfluences</span>;
<span style="color: black">CurrentInfluence</span>++)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
TempVertex</span>&nbsp;&nbsp;&nbsp; += ((<span style="color: black">Vertex</span> * </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *<span style="color: blue">this</span>-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[(*<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexInfluences</span>)[<span style="color: black">CurrentVertex</span>]-&gt;<span style="color: black">m_Joints</span>[<span style="color: black">CurrentInfluence</span>]]-&gt;<span style="color: black">m_SkinningMatrix</span>) 
* </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexWeightsArray</span>[(*<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexInfluences</span>)[<span style="color: black">CurrentVertex</span>]-&gt;<span style="color: black">m_Weights</span>[<span style="color: black">CurrentInfluence</span>]]);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<span style="font-size: 10.0pt; font-family: Courier New; color: blue">this</span><span style="font-size: 10.0pt; font-family: Courier New">-&gt;<span style="color: black">m_SkeletonData</span>-&gt;<span style="color: black">m_Bones</span>[(*<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexInfluences</span>)[<span style="color: black">CurrentVertex</span>]-&gt;<span style="color: black">m_Joints</span>[<span style="color: black">CurrentInfluence</span>]]-&gt;<span style="color: black">m_SkinningMatrix</span>-&gt;<span style="color: black">RotateVector</span>(<span style="color: black">Normal</span>,<span style="color: black">TempNormalTransform</span>);</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-size: 10.0pt; font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">TempNormal</span>&nbsp; += <span style="color: black">
TempNormalTransform</span> * <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexWeightsArray</span>[(*<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexInfluences</span>)[<span style="color: black">CurrentVertex</span>]-&gt;<span style="color: black">m_Weights</span>[<span style="color: black">CurrentInfluence</span>]];</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-size: 10.0pt; font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: black">TotalJointsWeight</span> += <span style="color: blue">
this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexWeightsArray</span>[(*<span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_VertexInfluences</span>)[<span style="color: black">CurrentVertex</span>]-&gt;<span style="color: black">m_Weights</span>[<span style="color: black">CurrentInfluence</span>]];</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> 
(<span style="color: black">TotalJointsWeight</span> != 1.0f)</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
NormalizedWeight</span> = 1.0f / <span style="color: black">TotalJointsWeight</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
TempVertex</span> *= <span style="color: black">NormalizedWeight</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: black">
TempNormal</span> *= <span style="color: black">NormalizedWeight</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_SkinnedVerticesArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3)&nbsp;&nbsp;&nbsp; ] = <span style="color: black">TempVertex</span>.<span style="color: black">x</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_SkinnedVerticesArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 1] = <span style="color: black">TempVertex</span>.<span style="color: black">y</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_SkinnedVerticesArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 2] = <span style="color: black">TempVertex</span>.<span style="color: black">z</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_SkinnedNormalsArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3)&nbsp;&nbsp;&nbsp; ] = <span style="color: black">TempNormal</span>.<span style="color: black">x</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_SkinnedNormalsArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 1] = <span style="color: black">TempNormal</span>.<span style="color: black">y</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">this</span>-&gt;<span style="color: black">m_GeometryData</span>-&gt;<span style="color: black">m_SkinnedNormalsArray</span>[(<span style="color: black">CurrentVertex</span> 
* 3) + 2] = <span style="color: black">TempNormal</span>.<span style="color: black">z</span>;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New">&nbsp;&nbsp;&nbsp;&nbsp; }</span></p>
<p class="MsoNormal"><span style="font-family: Courier New">}</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">If you read the comments 
in the beginning of the functions it says how the skinning is done on this data 
that we have read so far. </span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-size: 10.0pt; font-family: Courier New; color: green">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">The skinning calculation 
for each vertex v in a bind shape is</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">for i to n</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;&nbsp;&nbsp;&nbsp; v += {[(v * BSM) * 
IBMi * JMi] * JW}</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">&nbsp;</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green"> n: The number of joints 
that influence vertex v</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green"> BSM: Bind-shape matrix</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green"> IBMi: Inverse bind-pose 
matrix of joint i</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green"> JMi: Transformation 
matrix of joint i</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green"> JW: Weight of the 
influence of joint i on vertex v</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-family: Courier New; color: green">I have Got (v * BSM) and (IBMi 
* JMi) already multiplied since they are constants</span></p>
<p class="MsoNormal" style="text-autospace: none">
<span style="font-size: 10.0pt; font-family: Courier New; color: green">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">As we have discussed 
already I have </span><span style="font-family: Courier New; color: green">(v * 
BSM) </span><span style="font-family: Arial">and</span><span style="font-family: Courier New; color: green"> 
(IBMi * JMi)</span><span style="font-family: Arial"> already multiplied from the
</span><span style="font-family: Courier New; color: black">SetupSkeleton()
</span><span style="font-family: Arial">function, and we run a lope for all the 
vertices in the character and get both the current vertex as well as current 
normal (remember that the normal is also pre-multiplied with Bind Shape Matrix) 
and we run another nested lope for each bone (influence) influencing this vertex 
and take its weight and </span>
<span style="font-family: Courier New; color: black">m_SkinningMatrix </span>
<span style="font-family: Arial">and multiply them with the current vertex, 
which is already multiplied with Bind shape matrix, and then save it back in the 
copy of the Vertices array (</span><span style="font-family: Courier New; color: black">m_SkinnedNormalsArray</span><span style="font-family: Arial">) 
which we talked about when we created the data structure of CGeometryData. Now 
if we use this changed vertex and display the character, we will see the 
character in the current frames pose. This is the simple way of doing one frame 
of skinning for the character, if we want to animate it for the whole animation 
key frames, we must iterate for all the frames over time and call </span>
<span style="font-family: Courier New; color: black">SetupSkeleton() </span>
<span style="font-family: Arial">and</span><span style="font-family: Courier New; color: black"> 
SetupBindPose</span><span style="font-family: Courier New">() </span>
<span style="font-family: Arial">in that order.</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">As we discussed before if 
the time falls in between two key frames then we have to do interpolation on the 
two transforms for those two key frames. And then use the new value of transform 
to setup the skeleton. But once you have done the simple form of just running 
the character on all the key frames only, you can take the next step and do the 
interpolated animations or smooth animation. For that you might also like to 
save the transforms in quaternion instead of matrices. </span></p>
<p class="MsoNormal"><span style="font-family: Arial">This animation process can 
get as much complicated as you want it to be, in these implementations that I 
presented in this set of tutorials you will find the simple most animations you 
can achieve. You dont even need to worry about any interpolations and such 
until you have your character changing pose from one frame to another. Once you 
have achieved that, you can go for improving your animation system and introduce 
things like, Smooth animation, Animations Instancing system, blending two 
animations, Layering two animations and doing Forward Kinematics on your 
animations etc and it never ends :).</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">I hope this tutorial will 
help people in working with COLLADA as well as doing skeletal animations, please 
dont hesitate to bust my ass with your constructive comments and criticism. You 
can always reach me through my email address given in the contact section of the 
website.</span></p>


<br>
<br>
<br>
<a name="Leave_Comment_CL2"></a>
<br>
<br>
<br>
<!--Start Comments Section-->
<iframe id="CommentIFrame2" name="CommentIFrame2" frameborder="0" src="./Collada_Tutorial_2_files/CommentForm.htm" style="width:100%;" onload="if (window.parent &amp;&amp; window.parent.autoIframe) {window.parent.autoIframe(&#39;CommentIFrame2&#39;);}"></iframe>
<!--Ends Comments Section-->

<!--Start Counter-->
<!--End Counter-->

<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-family: Arial">&nbsp;</span></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">List of Figures</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 1: CBAHeader.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 2: CBAData.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 3: ModelingPose.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 4: OnlySkeleton.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 5: Bindpose.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 6: Hierarchy.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 7: Weight0.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 8: Weight1.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 9: Weight2.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Figure 10: Animation.jpg</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">&nbsp;</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">&nbsp;</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">&nbsp;</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">&nbsp;</span></font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Tags: </span>
</font></p>
<p class="MsoNormal"><font color="#C0C0C0"><span style="font-family: Arial">Skinning in 
COLLADA, 
Software Skinning, Skeletal Animation System in COLLADA, Skeletal Animation in 
COLLADA, COLLADA Animation Tutorial, COLLADA Skeletal Animation Tutorial, 
COLLADA Skeleton Animation Tutorial, Animation Data in COLLADA, Beginning 
COLLADA Programming, Starting COLLADA, COLLADA for Beginners, Step by Step 
Programming COLLADA, Reading COLLADA documents Step by Step, Exporting COLLADA 
documents, Importing Data from COLLADA, Importing Skeleton from COLLADA, Importing 
Exporting COLLADA documents in C++, COLLADA DOM, Feelings Software, COLLADA 
Conditioners, Working with COLLADA in C++, Simple Animation in COLLADA. COLLADA 
Step by Step Tutorial, Learn COLLADA in days, Skeletal Animation in OpenGL, 
Reading COLLADA documents in C++ Using OpenGL, Reading COLLADA documents Step by Step in 
OpenGL, COLLADA documents in DirectX, Character Animations in COLLADA, Step by Step 
Character Animations using COLLADA. Step by Step Character animation Tutorial 
using C++</span></font></p>
<p class="MsoNormal" align="right" style="text-align: right">&nbsp;</p>
 

<p></p>



<script charset="utf-8"> (function(w, d, g, J) { var e = J.stringify || J.encode; d[g] = d[g] || {}; d[g]['showValidImages'] = d[g]['showValidImages'] || function() { w.postMessage(e({'msg': {'g': g, 'm':'s'}}), location.href); } })(window, document, '__huaban', JSON); </script><pinit id="__huaban_Button" style="display: none;"><a id="__huaban_thunderpinBtn" href="http://www.wazim.com/Collada_Tutorial_2.htm#" title="&#24555;&#36895;&#37319;&#38598;" class="thunderpin"><strong><em></em></strong></a><a id="__huaban_pinBtn" href="http://www.wazim.com/Collada_Tutorial_2.htm#" title="&#37319;&#38598;&#21040;&#33457;&#29923;" class="pin">&#37319;&#38598;&#21040;&#33457;&#29923;</a></pinit></body></html>